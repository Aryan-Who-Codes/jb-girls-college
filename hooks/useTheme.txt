'use client'

import { useState, useEffect } from 'react'
import { Theme, themes } from '@/types/theme'

export function useTheme() {
  const [theme, setTheme] = useState<Theme>(() => {
    // Initialize from localStorage during first render
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('theme') as Theme
      return saved && Object.keys(themes).includes(saved) ? saved : 'light'
    }
    return 'light'
  })
  
  const currentTheme = themes[theme]

  useEffect(() => {
    try {
      localStorage.setItem('theme', theme)
      // Apply theme classes to document root
      document.documentElement.className = currentTheme.background
    } catch (error) {
      console.error('Failed to persist theme:', error)
    }
  }, [theme, currentTheme])

  const toggleTheme = () => {
    const themeKeys = Object.keys(themes) as Theme[]
    const currentIndex = themeKeys.indexOf(theme)
    const nextTheme = themeKeys[(currentIndex + 1) % themeKeys.length]
    setTheme(nextTheme)
  }

  return { theme, currentTheme, setTheme, toggleTheme }
}
